# DPO GPT-2 

Данный проект посвящён обучению и оценке модели GPT-2, дообученной с помощью метода Direct Preference Optimization (DPO). 
Проект включает полный конвейер: подготовка данных, обучение, сохранение результатов и последующая оценка модели.
---

## Структура проекта

- `data/` — папка для предварительной обработки данных  
  - `load_data.py` — скрипт подготовки и токенизации датасета  
  - `prepared_pairs.pt` — подготовленные токенизированные данные (создаётся скриптом `load_data.py`)

- `results/` — папка для результатов и сохранённых моделей  
  - `eval.py` — скрипт для оценки модели, визуализации и подсчёта метрик  
  - `val_raw.json` — файл с валидационными данными (создаётся скриптом `load_data.py`)  
  - `eval_results.json` — результаты оценки (создаётся скриптом `eval.py`)  
  - `losses.json` — лог обучения (создаётся скриптом `train_dpo.py`)  
  - `dpo_finetuned_gpt2/` — сохранённая обученная модель и токенизатор (создаётся скриптом `train_dpo.py`)

- `src/` — основная логика тренировки  
  - `train_dpo.py` — скрипт тренировки модели с ранней остановкой

- `dpo_gpt2.ipynb` - ноутбук со всеми этапами; подходит для облачного запуска

---

## Установка

Рекомендуется использовать виртуальное окружение (venv или conda).

1. Клонировать репозиторий:
    ```bash
    git clone https://github.com/kkkRina/DPO_GPT2.git
    cd DPO_GPT2
    ```

2. Установить зависимости:
    ```bash
    pip install -r requirements.txt
    ```

---

## Использование

### Подготовка данных

Запустите подготовку данных и их токенизацию:

```bash
python data/load_data.py
```
В результате будут созданы файлы:

`prepared_pairs.pt` — токенизированный датасет для обучения
`val_raw.json` — исходные данные для валидации

### Обучение модели
Запустите обучение модели командой:

```bash
python src/train_dpo.py
```

В процессе обучения будут созданы и обновлены файлы и папки:

`../results/losses.json` — логи значений функции потерь и метрик
`../results/dpo_finetuned_gpt2/` — сохранённая модель и токенизатор

### Оценка модели
Запустите скрипт оценки модели:

```bash
python results/eval.py
```


